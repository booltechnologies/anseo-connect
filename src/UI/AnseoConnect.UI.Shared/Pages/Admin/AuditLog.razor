@page "/admin/audit"
@using AnseoConnect.Client
@using AnseoConnect.Client.Models
@using AnseoConnect.Data.Entities
@using Microsoft.AspNetCore.Components

<PageTitle>Audit Log</PageTitle>

<h2>Audit Log</h2>
<p>View audit events for GDPR compliance and security monitoring.</p>

@if (_isLoading)
{
    <p><em>Loading audit events...</em></p>
}
else if (_events == null || !_events.Items.Any())
{
    <p><em>No audit events found.</em></p>
}
else
{
    <div class="audit-filters mb-3">
        <p><em>Filter controls will be implemented here (actor, action, entity, date range)</em></p>
    </div>

    <DxGrid Data="@_events.Items">
        <Columns>
            <DxGridDataColumn FieldName="@nameof(AuditEvent.OccurredAtUtc)" Caption="Timestamp" />
            <DxGridDataColumn FieldName="@nameof(AuditEvent.ActorName)" Caption="Actor" />
            <DxGridDataColumn FieldName="@nameof(AuditEvent.Action)" Caption="Action" />
            <DxGridDataColumn FieldName="@nameof(AuditEvent.EntityType)" Caption="Entity Type" />
            <DxGridDataColumn FieldName="@nameof(AuditEvent.EntityDisplayName)" Caption="Entity" />
        </Columns>
    </DxGrid>

    <div class="mt-3">
        <p><em>Showing @_events.Items.Count of @_events.TotalCount events. Export functionality will be implemented here.</em></p>
    </div>
}

@code {
    [Inject] private AuditClient AuditClient { get; set; } = null!;

    private PagedResult<AuditEvent>? _events;
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _events = await AuditClient.SearchAuditEventsAsync(
                skip: 0,
                take: 50,
                cancellationToken: default);

            _isLoading = false;
        }
        catch
        {
            _isLoading = false;
            // Error handling would be implemented here
        }
    }
}
