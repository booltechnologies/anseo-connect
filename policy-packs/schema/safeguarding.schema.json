{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://anseo.ie/schemas/policy-pack/safeguarding.schema.json",
  "title": "Safeguarding policy module schema (Anseo Connect)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "enabled",
    "alwaysHumanReview",
    "restrictedCaseType",
    "patternTriggers",
    "keywordTriggers",
    "recipientRouting",
    "playbook"
  ],
  "properties": {
    "enabled": {
      "type": "boolean"
    },
    "alwaysHumanReview": {
      "type": "boolean"
    },
    "restrictedCaseType": {
      "type": "string",
      "minLength": 1
    },
    "quietHoursOverride": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "suppressNotifications",
        "channelPriorityOverride"
      ],
      "properties": {
        "suppressNotifications": {
          "type": "boolean"
        },
        "channelPriorityOverride": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "IN_APP",
              "EMAIL",
              "SMS",
              "WHATSAPP",
              "VOICE_AUTODIAL"
            ]
          },
          "minItems": 1
        }
      }
    },
    "recipientRouting": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "roles",
        "routingRules"
      ],
      "properties": {
        "roles": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "primary",
            "secondary",
            "optional"
          ],
          "properties": {
            "primary": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1
            },
            "secondary": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "optional": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "routingRules": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "name",
              "when",
              "notify",
              "ackSlaMinutes"
            ],
            "properties": {
              "name": {
                "type": "string"
              },
              "when": {
                "type": "object"
              },
              "notify": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "primary",
                  "secondaryOnNoAck"
                ],
                "properties": {
                  "primary": {
                    "type": "boolean"
                  },
                  "secondaryOnNoAck": {
                    "type": "boolean"
                  }
                }
              },
              "ackSlaMinutes": {
                "type": "integer",
                "minimum": 1
              }
            }
          },
          "minItems": 1
        }
      }
    },
    "patternTriggers": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "description",
          "whenAll",
          "action"
        ],
        "properties": {
          "id": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string"
          },
          "whenAll": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "metric",
                "op",
                "value"
              ],
              "properties": {
                "metric": {
                  "type": "string",
                  "minLength": 1
                },
                "op": {
                  "type": "string",
                  "enum": [
                    ">=",
                    ">",
                    "<=",
                    "<",
                    "==",
                    "!="
                  ]
                },
                "value": {
                  "type": [
                    "number",
                    "integer",
                    "string",
                    "boolean"
                  ]
                }
              }
            },
            "minItems": 1
          },
          "action": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "type",
              "severity"
            ],
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "CREATE_ALERT"
                ]
              },
              "severity": {
                "type": "string",
                "enum": [
                  "LOW",
                  "MEDIUM",
                  "HIGH",
                  "CRITICAL"
                ]
              }
            }
          }
        }
      }
    },
    "keywordTriggers": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "mode",
        "caseInsensitive",
        "phrases",
        "action"
      ],
      "properties": {
        "mode": {
          "type": "string",
          "enum": [
            "PHRASE_MATCH"
          ]
        },
        "caseInsensitive": {
          "type": "boolean"
        },
        "phrases": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "minItems": 1
          },
          "minProperties": 1
        },
        "action": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "type",
            "severity"
          ],
          "properties": {
            "type": {
              "type": "string",
              "enum": [
                "CREATE_ALERT"
              ]
            },
            "severity": {
              "type": "string",
              "enum": [
                "LOW",
                "MEDIUM",
                "HIGH",
                "CRITICAL"
              ]
            }
          }
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "aiConstraints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "allowedActions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "disallowedActions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "notes": {
          "type": "string"
        }
      }
    },
    "audit": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "recordAcknowledgements": {
          "type": "boolean"
        },
        "recordViewEvents": {
          "type": "boolean"
        }
      }
    },
    "playbook": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "checklists",
        "ui"
      ],
      "properties": {
        "checklists": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "checklistId",
              "name",
              "items"
            ],
            "properties": {
              "checklistId": {
                "type": "string",
                "minLength": 1
              },
              "name": {
                "type": "string",
                "minLength": 1
              },
              "items": {
                "type": "array",
                "items": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": [
                    "id",
                    "label",
                    "required"
                  ],
                  "properties": {
                    "id": {
                      "type": "string",
                      "minLength": 1
                    },
                    "label": {
                      "type": "string",
                      "minLength": 1
                    },
                    "required": {
                      "type": "boolean"
                    }
                  }
                },
                "minItems": 1
              }
            }
          },
          "minItems": 1
        },
        "ui": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "requireChecklistCompletionToClose",
            "allowPartialSave",
            "showAsTimeline"
          ],
          "properties": {
            "requireChecklistCompletionToClose": {
              "type": "boolean"
            },
            "allowPartialSave": {
              "type": "boolean"
            },
            "showAsTimeline": {
              "type": "boolean"
            }
          }
        }
      }
    }
  }
}